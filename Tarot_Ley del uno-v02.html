<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot de la Ley del Uno (con API de Google)</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #1a1a1a, #2c003e);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 800px;
            width: 90%;
            margin: 0 auto;
        }

        .botones {
            margin: 20px 0;
        }

        button {
            background: #4B0082;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1rem;
        }

        button:hover {
            background: #6A0DAD;
            transform: scale(1.05);
        }

        #mazo {
            display: none; /* Oculto inicialmente */
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .carta {
            width: 120px;
            height: 180px;
            border-radius: 10px;
            border: 2px solid gold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            background-size: cover;
            font-size: 0.8rem;
        }

        .carta.boca-abajo {
            background: linear-gradient(45deg, #2c003e, #4B0082);
            color: transparent;
        }

        #cartas-sacadas {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .interpretacion {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none; /* Oculto inicialmente */
            width: 90%;
            max-width: 700px;
            text-align: left;
        }

        .triada{
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .arquetipo{
            margin-bottom: 1rem;
        }

        .relaciones {
            margin-top: 1.5rem;
            border-top: 1px solid gold;
            padding-top: 1rem;
        }

        .loco {
            margin-top: 1.5rem;
            border-top: 1px solid #ccc;
            padding-top: 1rem;
            font-style: italic;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: gold;
        }

        h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        p {
            font-size: 1rem;
            line-height: 1.4;
        }

        small{
            font-size: 0.9rem;
        }

        #cargando {
            display: none;
            margin-top: 20px;
            color: gold;
            font-style: italic;
        }
      #conversacion {
            display: none; /* Oculto inicialmente */
        }
        #entrada-usuario{
            width: 95%;
            margin: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tarot de la Ley del Uno (con API de Google)</h1>
        <div class="botones">
            <button onclick="iniciarTirada()">Iniciar Tirada</button>
            <button onclick="barajar()" id="btnBarajar" disabled>Barajar</button>
            <button onclick="sacarCartas()" id="btnSacar" disabled>Sacar Cartas</button>
        </div>
        <p id="mensaje"></p>
        <div id="pregunta-consultante"></div>
        <div id="mazo"></div>
        <div id="cartas-sacadas"></div>
        <div id="cargando">Interpretando...</div>
        <div id="interpretacion" class="interpretacion"></div>
        <div id="conversacion">
            <textarea id="entrada-usuario" rows="4" cols="50" placeholder="Escribe tu pregunta o comentario aqu√≠..."></textarea><br>
            <button onclick="enviarPreguntaUsuario()">Enviar</button>
        </div>
    </div>

    <script>
        // Arquetipos (MUY AMPLIADO) - Informaci√≥n extra√≠da de las Sesiones 76-82
        const ARCANOS = [
            // MENTE
            {
                nombre: 'El Mago',
                grupo: 'Mente',
                significado: 'Voluntad consciente, la Matriz de la Mente.',
                descripcionRa: 'La Matriz de la Mente. Representa el principio masculino de la creaci√≥n consciente, la voluntad que se alinea con el infinito. Es el "Mago" que se conoce a s√≠ mismo.',
                citaRa: [
                    '"La Matriz es el principio masculino de la creaci√≥n consciente" (Sesi√≥n 81.6)',
                    '"El Mago es la conciencia creando realidad" (Sesi√≥n 81)'
                ],
                sesiones: [78, 81]
            },
            {
                nombre: 'La Sacerdotisa',
                grupo: 'Mente',
                significado: 'Intuici√≥n, el Potenciador de la Mente.',
                descripcionRa: 'El Potenciador de la Mente. Representa el inconsciente colectivo, el acceso a la sabidur√≠a oculta m√°s all√° del velo. Es la contraparte femenina del Mago.',
                citaRa: [
                    '"El Potenciador del Esp√≠ritu contiene el misterio del infinito" (Sesi√≥n 82.3)',
                    '"La Sacerdotisa es el acceso al conocimiento infinito" (Sesi√≥n 81)'
                ],
                sesiones: [78, 82]
            },
            {
                nombre: 'La Emperatriz',
                grupo: 'Mente',
                significado: 'Creatividad, el Catalizador de la Mente.',
                descripcionRa: 'El Catalizador de la Mente. Representa la creatividad divina, el principio femenino que gesta las ideas.  Es la acci√≥n de la intuici√≥n sobre la voluntad.',
                citaRa: [
                    '"Catalizador de la Mente - Creatividad divina" (Sesi√≥n 78)'
                ],
                sesiones: [78]
            },
            {
                nombre: 'El Emperador',
                grupo: 'Mente',
                significado: 'Estructura, la Experiencia de la Mente.',
                descripcionRa: 'La Experiencia de la Mente.  Representa la estructura material, el orden y las reglas que dan forma a la experiencia.  Es el resultado de la voluntad actuando.',
                citaRa: [
                    '"Experiencia de la Mente - Estructura material" (Sesi√≥n 78)'
                ],
                sesiones: [78]
            },
            {
                nombre: 'El Hierofante',
                grupo: 'Mente',
                significado: 'Creencias, el Significante de la Mente.',
                descripcionRa: 'El Significante de la Mente. Representa los sistemas de creencias, la tradici√≥n sagrada y las estructuras de pensamiento que dan significado a la experiencia.',
                citaRa: [
                    '"Significante de la Mente - Sistema de creencias" (Sesi√≥n 80)'
                ],
                sesiones: [80]
            },
            {
                nombre: 'Los Enamorados',
                grupo: 'Mente',
                significado: 'Elecci√≥n, la Transformaci√≥n de la Mente.',
                descripcionRa: 'La Transformaci√≥n de la Mente. Representa la elecci√≥n √©tica, el amor incondicional y la integraci√≥n de los opuestos.  Es el punto de decisi√≥n.',
                citaRa: [
                    '"Transformaci√≥n de la Mente - Elecci√≥n √©tica" (Sesi√≥n 78)'
                ],
                sesiones: [78]
            },
            {
                nombre: 'El Carro',
                grupo: 'Mente',
                significado: 'Direcci√≥n, la V√≠a de la Mente.',
                descripcionRa: 'La V√≠a de la Mente. Representa el control de fuerzas opuestas, la direcci√≥n consciente del yo y la voluntad en acci√≥n.  Es el camino elegido.',
                citaRa: [
                    '"V√≠a de la Mente - Direcci√≥n consciente" (Sesi√≥n 78)'
                ],
                sesiones: [78]
            },

            // CUERPO
            {
                nombre: 'La Justicia',
                grupo: 'Cuerpo',
                significado: 'Equilibrio, la Matriz del Cuerpo.',
                descripcionRa: 'La Matriz del Cuerpo. Representa la ley c√≥smica, el equilibrio k√°rmico y las consecuencias de las acciones.  Es la base de la experiencia f√≠sica.',
                citaRa: [
                    '"Matriz del Cuerpo - Ley c√≥smica" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'El Ermita√±o',
                grupo: 'Cuerpo',
                significado: 'Sabidur√≠a interior, el Potenciador del Cuerpo.',
                descripcionRa: 'El Potenciador del Cuerpo.  Representa la sabidur√≠a interior, la b√∫squeda de la verdad en la soledad y la introspecci√≥n.  Es la gu√≠a interna.',
                citaRa: [
                    '"Potenciador del Cuerpo - Sabidur√≠a interior" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'La Rueda de la Fortuna',
                grupo: 'Cuerpo',
                significado: 'Destino, el Catalizador del Cuerpo.',
                descripcionRa: 'El Catalizador del Cuerpo. Representa los ciclos c√≥smicos, el movimiento del destino y los eventos que impulsan el crecimiento.  Es el cambio inevitable.',
                citaRa: [
                    '"Catalizador del Cuerpo - Ciclos del destino" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'La Fuerza',
                grupo: 'Cuerpo',
                significado: 'Dominio, la Experiencia del Cuerpo.',
                descripcionRa: 'La Experiencia del Cuerpo. Representa el dominio energ√©tico, el poder del amor sobre los instintos y la fuerza interior.  Es la compasi√≥n.',
                citaRa: [
                    '"Experiencia del Cuerpo - Dominio energ√©tico" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'El Colgado',
                grupo: 'Cuerpo',
                significado: 'Perspectiva, la Transformaci√≥n del Cuerpo.',
                descripcionRa: 'La Transformaci√≥n del Cuerpo.  Representa el cambio de perspectiva, el sacrificio consciente y la renuncia a lo viejo para dar paso a lo nuevo.',
                citaRa: [
                    '"Transformaci√≥n del Cuerpo - Cambio de perspectiva" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'La Muerte',
                grupo: 'Cuerpo',
                significado: 'Renacimiento, la V√≠a del Cuerpo.',
                descripcionRa: 'La V√≠a del Cuerpo. Representa el renacimiento, la transformaci√≥n necesaria y la muerte del ego.  Es el final de un ciclo y el comienzo de otro.',
                citaRa: [
                    '"V√≠a del Cuerpo - Renacimiento" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },
            {
                nombre: 'La Templanza',
                grupo: 'Cuerpo',
                significado: 'Integraci√≥n, el Significante del Cuerpo.',
                descripcionRa: 'El Significante del Cuerpo. Representa la alquimia c√≥smica, la integraci√≥n de los opuestos y el equilibrio.  Es la armon√≠a.',
                citaRa: [
                    '"Significante del Cuerpo - Alquimia c√≥smica" (Sesi√≥n 77)'
                ],
                sesiones: [77]
            },

            // ESP√çRITU
            {
                nombre: 'El Diablo',
                grupo: 'Esp√≠ritu',
                significado: 'Ilusi√≥n, la Matriz del Esp√≠ritu.',
                descripcionRa: 'La Matriz del Esp√≠ritu. Representa la ilusi√≥n de separaci√≥n, las ataduras materiales y la oscuridad que oculta la luz.  Es la sombra.',
                citaRa: [
                    '"Matriz del Esp√≠ritu - Ilusi√≥n de separaci√≥n" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },
            {
                nombre: 'La Torre',
                grupo: 'Esp√≠ritu',
                significado: 'Revelaci√≥n, el Potenciador del Esp√≠ritu.',
                descripcionRa: 'El Potenciador del Esp√≠ritu. Representa la destrucci√≥n de las falsas estructuras, la revelaci√≥n repentina y el despertar.  Es el rel√°mpago.',
                citaRa: [
                    '"Potenciador del Esp√≠ritu - Destrucci√≥n de lo falso" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },
            {
                nombre: 'La Estrella',
                grupo: 'Esp√≠ritu',
                significado: 'Fe, el Catalizador del Esp√≠ritu.',
                descripcionRa: 'El Catalizador del Esp√≠ritu.  Representa la fe c√≥smica, la gu√≠a divina y la esperanza en el infinito.  Es la luz en la oscuridad.',
                citaRa: [
                    '"Catalizador del Esp√≠ritu - Fe c√≥smica" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },
             {
                nombre: 'La Luna',
                grupo: 'Esp√≠ritu',
                significado: 'Pruebas, la Experiencia del Esp√≠ritu.',
                descripcionRa: 'La Experiencia del Esp√≠ritu. Representa las pruebas del alma, el viaje a trav√©s del inconsciente y los desaf√≠os que conducen al crecimiento.',
                citaRa: [
                     '"Experiencia del Esp√≠ritu - Pruebas del alma" (Sesi√≥n 79)'
                 ],
                sesiones: [79]
            },
            {
                nombre: 'El Sol',
                grupo: 'Esp√≠ritu',
                significado: 'Iluminaci√≥n, la Transformaci√≥n del Esp√≠ritu.',
                descripcionRa: 'La Transformaci√≥n del Esp√≠ritu. Representa la iluminaci√≥n, la verdad esencial y la claridad que disipa la oscuridad.  Es la conciencia.',
                citaRa: [
                    '"Transformaci√≥n del Esp√≠ritu - Iluminaci√≥n" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },
            {
                nombre: 'El Juicio',
                grupo: 'Esp√≠ritu',
                significado: 'Despertar, la V√≠a del Esp√≠ritu.',
                descripcionRa: 'La V√≠a del Esp√≠ritu.  Representa el llamado c√≥smico, el despertar de la memoria espiritual y la rendici√≥n de cuentas.  Es el llamado a la unidad.',
                citaRa: [
                    '"V√≠a del Esp√≠ritu - Llamado c√≥smico" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },
            {
                nombre: 'El Mundo',
                grupo: 'Esp√≠ritu',
                significado: 'Unidad, el Significante del Esp√≠ritu.',
                descripcionRa: 'El Significante del Esp√≠ritu. Representa la unidad lograda, la completitud del ser y la integraci√≥n de todas las experiencias.  Es la totalidad.',
                citaRa: [
                    '"Significante del Esp√≠ritu - Unidad lograda" (Sesi√≥n 79)'
                ],
                sesiones: [79]
            },

            // INTEGRADOR
            {
                nombre: 'El Loco',
                grupo: 'Integrador',
                significado: 'Potencial infinito, el Viajero Eterno.',
                descripcionRa: 'El Arquitecto del potencial infinito. Representa el principio y el fin, el caos creativo, la libertad absoluta y el viaje del alma a trav√©s de la experiencia.',
                citaRa: [
                    '"El Arquitecto de lo Imposible, que construye desde el vac√≠o" (Sesi√≥n 82.12)',
                    '"El Loco recuerda: Esta combinaci√≥n [...] es una ilusi√≥n al servicio del aprendizaje" (Sesi√≥n 77)'
                ],
                sesiones: [77, 82]
            }
        ];

        // RELACIONES ENTRE ARQUETIPOS (MUY AMPLIADO) - Basado en Sesiones 76, 77, 81
        // Esto es un *ejemplo*, y se puede expandir *mucho* m√°s.
const RELACIONES_RA = {
    // Mente -> Cuerpo (Sesi√≥n 77: Direccionalidad energ√©tica)
    'El Mago-La Rueda de la Fortuna': 'La voluntad consciente (El Mago) debe aprender a fluir con los ciclos del destino (La Rueda). La acci√≥n individual se encuentra con las fuerzas externas.',
    'La Sacerdotisa-El Ermita√±o': 'La intuici√≥n (La Sacerdotisa) gu√≠a la b√∫squeda interior (El Ermita√±o). El conocimiento oculto se revela en la soledad.',
    'La Emperatriz-La Fuerza': 'La creatividad (La Emperatriz) se canaliza a trav√©s del dominio de los instintos (La Fuerza). La acci√≥n nutricia se combina con la compasi√≥n.',
    'El Emperador-El Colgado': 'La estructura (El Emperador) se enfrenta a la necesidad de un cambio de perspectiva (El Colgado). El orden establecido se desaf√≠a.',
    'El Hierofante-La Muerte': 'Las creencias (El Hierofante) se confrontan con la transformaci√≥n (La Muerte). Los sistemas de pensamiento se renuevan.',
    'Los Enamorados-La Templanza': 'La elecci√≥n (Los Enamorados) conduce a la integraci√≥n (La Templanza).  La decisi√≥n √©tica lleva al equilibrio.',
    'El Carro-La Justicia': 'La voluntad (El Carro) se somete a la ley c√≥smica (La Justicia). La acci√≥n dirigida se enfrenta a las consecuencias.',

    // Cuerpo -> Esp√≠ritu (Sesi√≥n 76: Catalizadores)
    'La Justicia-El Diablo': 'El equilibrio k√°rmico (La Justicia) revela las ataduras materiales (El Diablo). La ley de causa y efecto se manifiesta.',
    'El Ermita√±o-La Torre': 'La sabidur√≠a interior (El Ermita√±o) prepara para la destrucci√≥n de lo falso (La Torre). La introspecci√≥n conduce a la revelaci√≥n.',
    'La Rueda de la Fortuna-La Estrella': 'Los ciclos del destino (La Rueda) traen esperanza (La Estrella). El cambio trae fe.',
    'La Fuerza-La Luna': 'El dominio energ√©tico (La Fuerza) se enfrenta a las pruebas del alma (La Luna). La compasi√≥n se enfrenta a los miedos.',
    'El Colgado-El Sol': 'El cambio de perspectiva (El Colgado) conduce a la iluminaci√≥n (El Sol). El sacrificio trae claridad.',
    'La Muerte-El Juicio': 'La transformaci√≥n (La Muerte) es un llamado al despertar (El Juicio). El renacimiento es un llamado a la consciencia.',
    'La Templanza-El Mundo': 'La integraci√≥n (La Templanza) conduce a la unidad (El Mundo). El equilibrio lleva a la totalidad.',

    // Esp√≠ritu -> Mente (Sesi√≥n 79: Influencia)
    'El Diablo-El Mago': "La ilusi√≥n de la separaci√≥n (El Diablo) desaf√≠a la voluntad del individuo(El Mago)",
    'La Torre-La Sacerdotisa': "La destrucci√≥n de las viejas ideas, abre camino a la intuici√≥n(La Sacerdotisa)",
    'La Estrella-La Emperatriz': "La Esperanza y la f√©(La Estrella) alimentan la creatividad(La Emperatriz)",
    'La Luna-El Emperador':"Las pruebas internas, fortalecen el poder de manifestar en el mundo(El Emperador)",
    'El Sol-El Hierofante':"La verdad ilumina y da un nuevo significado a las creencias(El Hierofante)",
    'El Juicio-Los Enamorados':"El llamado a despertar hace tomar decisiones importantes(Los Enamorados)",
    'El Mundo-El Carro': "La sensaci√≥n de unidad, da un proposito y una direcci√≥n a la vida(El Carro)",
    // Combinaciones con El Loco (Sesi√≥n 82)
    'El Loco-El Mago': 'El potencial infinito (El Loco) alimenta la voluntad consciente (El Mago). El viaje comienza con la intenci√≥n.',
    'El Loco-La Justicia': 'La libertad absoluta (El Loco) se encuentra con la ley c√≥smica (La Justicia). El caos se equilibra con el orden.',
    // ... (Se pueden a√±adir *muchas* m√°s combinaciones con El Loco) ...
        };

        let mazo = [];
        let cartasSacadas = [];
        let pregunta = ""; // Variable global para almacenar la pregunta inicial
        let conversacion = []; //Historial de la conversacion

       function iniciarTirada() {
            // --- Primero, mostramos el mazo ---
            renderizarMazo();
            document.getElementById('mazo').style.display = 'flex';

            // --- PEDIR LA PREGUNTA AL USUARIO ---
            pregunta = prompt("¬øCu√°l es tu pregunta para el Tarot?");

            // --- Manejar el caso en que el usuario no escriba nada ---
            if (pregunta === null || pregunta.trim() === "") {
                pregunta = "Pregunta general sobre la situaci√≥n actual."; // Pregunta por defecto
            }

            // --- Mostrar la pregunta en la p√°gina ---
            document.getElementById('pregunta-consultante').innerHTML = `<p><strong>Pregunta:</strong> ${pregunta}</p>`;

            mazo = [...ARCANOS];  // ASEG√öRATE de que mazo se (re)inicializa aqu√≠
            cartasSacadas = [];
            document.getElementById('btnBarajar').disabled = false;
            document.getElementById('btnSacar').disabled = true;
            document.getElementById('interpretacion').style.display = 'none';
            document.getElementById('mensaje').textContent = 'Mazo listo. ¬°Baraja!';
            // Ya no es necesario llamar a renderizarMazo() aqu√≠, lo hacemos al principio
            document.getElementById('conversacion').style.display = 'none'; //Ocultamos conversacion
        }


        function barajar() {
            for (let i = mazo.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [mazo[i], mazo[j]] = [mazo[j], mazo[i]];
            }
            document.getElementById('btnSacar').disabled = false;
            document.getElementById('mensaje').textContent = '';
            renderizarMazo(); // Para que se vea que baraja
        }

function sacarCartas() {
    if (mazo.length < 3) return;

    cartasSacadas = mazo.splice(0, 3);
    renderizarMazo();          // Actualiza el mazo boca abajo (oculta las cartas no sacadas)
    renderizarCartasSacadas(); // Muestra las cartas sacadas

    // Mostrar el indicador de carga
    document.getElementById('cargando').style.display = 'block';
    // Deshabilitar el bot√≥n "Sacar Cartas" mientras se espera la respuesta
    document.getElementById('btnSacar').disabled = true;
    document.getElementById('conversacion').style.display = 'block'; //Mostramos conversacion

    // Llamar a la funci√≥n de interpretaci√≥n *despu√©s* de mostrar las cartas
    mostrarInterpretacion();
}

function renderizarMazo() {
    const contenedor = document.getElementById('mazo');
    contenedor.innerHTML = ''; //  *** ASEG√öRATE DE LIMPIAR ***
    mazo.forEach((carta, index) => {
        const div = document.createElement('div');
        div.className = 'carta boca-abajo';
        let simbolo = '';
        if (carta.grupo === 'Mente') simbolo = 'üß†';
        else if (carta.grupo === 'Cuerpo') simbolo = 'üå±';
        else if (carta.grupo === 'Esp√≠ritu') simbolo = '‚ú®';
        else if (carta.grupo === 'Integrador') simbolo = '‚ôæÔ∏è';

        div.innerHTML = `<small>${index + 1}</small><br>${simbolo}`;
        contenedor.appendChild(div);
    });
}

function renderizarCartasSacadas() {
    const contenedor = document.getElementById('cartas-sacadas');
    contenedor.innerHTML = ''; // *** ASEG√öRATE DE LIMPIAR ***

    cartasSacadas.forEach(carta => {
        const div = document.createElement('div');
        div.className = 'carta'; // Usamos la clase 'carta', NO 'carta boca-abajo'

        // --- A√ëADIMOS M√ÅS INFORMACI√ìN ---
        let simbolo = '';
        if (carta.grupo === 'Mente') simbolo = 'üß†';
        else if (carta.grupo === 'Cuerpo') simbolo = 'üå±';
        else if (carta.grupo === 'Esp√≠ritu') simbolo = '‚ú®';
        else if (carta.grupo === 'Integrador') simbolo = '‚ôæÔ∏è';

        div.innerHTML = `
            <h4>${carta.nombre} (${carta.grupo})</h4>
            <p>${simbolo}</p>  <!-- Mostrar el s√≠mbolo -->
        `; //  <-- SOLO NOMBRE, GRUPO Y SIMBOLO
        // --- (Si tuvieras im√°genes, aqu√≠ las a√±adir√≠as) ---

        contenedor.appendChild(div);
    });
}

async function mostrarInterpretacion() {
    const [mente, cuerpo, espiritu] = cartasSacadas;

    // --- CONSTRUIR EL PROMPT INICIAL ---
    const promptInicial = `
Eres una maga gitana experta en el Tarot, con un profundo conocimiento de la Ley del Uno (especialmente el Libro IV).
Interpreta la siguiente tirada de tres cartas *en relaci√≥n con la pregunta del consultante*.
S√© m√≠stica, profunda, usa met√°foras elaboradas, y haz referencias a los conceptos de la Ley del Uno
(mente/cuerpo/esp√≠ritu, arquetipos, el Loco como integrador, etc.). Cita textualmente fragmentos relevantes
del Libro IV de la Ley del Uno siempre que sea posible.

Pregunta del consultante:
${pregunta}

Las cartas son:

*   Carta 1 (Mente): ${mente.nombre} - ${mente.descripcionRa}
*   Carta 2 (Cuerpo): ${cuerpo.nombre} - ${cuerpo.descripcionRa}
*   Carta 3 (Esp√≠ritu): ${espiritu.nombre} - ${espiritu.descripcionRa}

Ofrece una interpretaci√≥n que incluya:

1.  **An√°lisis individual de cada carta:** Profundiza en el significado de cada carta
    en el contexto de la Ley del Uno y de la pregunta del consultante. Usa citas relevantes si es posible.
2.  **Relaciones entre las cartas:** Explica c√≥mo interact√∫an las energ√≠as de las cartas
    (Mente -> Cuerpo, Cuerpo -> Esp√≠ritu, Esp√≠ritu -> Mente). Usa la informaci√≥n de RELACIONES_RA
    si es relevante, pero *exp√°ndela* con tu propia sabidur√≠a m√≠stica.
    Describe las interacciones en t√©rminos de los conceptos de la Ley del Uno.
3.  **El Rol del Loco:** Siempre incluye una secci√≥n sobre c√≥mo El Loco integra la tirada y
    representa el viaje del alma, el potencial infinito y la paradoja de ser humano y esp√≠ritu a la vez.
4.  **Consejo o Reflexi√≥n Final:** Ofrece una conclusi√≥n que resuma la lectura y ofrezca una gu√≠a o
    reflexi√≥n, conectando la tirada con la b√∫squeda de la unidad y el servicio a los dem√°s,
    y *respondiendo directamente a la pregunta del consultante*.

Responde en formato HTML:
* Usa etiquetas <h3> para t√≠tulos principales.
* Usa <h4> para t√≠tulos de secci√≥n (ej. "Carta 1: El Mago").
* Usa <p> para los p√°rrafos de texto.
* Usa <em> para enfatizar palabras o frases clave.
* Incluye saltos de l√≠nea (<br>) para mejorar la legibilidad.
`;
    conversacion.push({ role: "user", parts: [{ text: promptInicial }] }); // Iniciamos el historial
    // --- HACER LA PETICI√ìN A LA API DE GOOGLE (Generative Language API) ---
    const apiKey = 'AIzaSyBEInEJP4491xocWdqS_H5p_xbEbLKbfFE'; //  ¬°¬°¬°REEMPLAZA ESTO!!!
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-002:generateContent?key=${apiKey}`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: conversacion, // Usamos el historial
                generationConfig: {
                    "maxOutputTokens": 2048,
                    "temperature": 0.95,
                    "topP": 0.95,
                    "topK": 40
                }
            })
        });

        if (!response.ok) {
            let errorText = await response.text();
            throw new Error(`Error de la API: ${response.status} - ${errorText}`);
        }

        const data = await response.json();
        let interpretacion = "";

        // --- MANEJO DE LA RESPUESTA (Generative Language API) ---
        if (data.candidates && data.candidates.length > 0 && data.candidates[0].content &&
            data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0)
        {
            interpretacion = data.candidates[0].content.parts[0].text;
            conversacion.push({ role: "model", parts: [{ text: interpretacion }] }); //A√±adimos al historial
        }
         else {
            interpretacion = "<p>Error: No se pudo obtener una interpretaci√≥n v√°lida.</p>";
            console.log("Respuesta de la API (fallida):", data); // LOG DE LA RESPUESTA
        }

        // --- A√ëADIR (no reemplazar) la interpretaci√≥n al historial ---
        document.getElementById('interpretacion').innerHTML += interpretacion;
        document.getElementById('interpretacion').style.display = 'block';

    } catch (error) {
        console.error('Error:', error);
        document.getElementById('interpretacion').innerHTML += `<p>Error al obtener la interpretaci√≥n: ${error.message}</p>`;
        document.getElementById('interpretacion').style.display = 'block';
    }
     finally { //asegurarse que se oculte
        document.getElementById('cargando').style.display = 'none';
         document.getElementById('btnSacar').disabled = false;//Se reactiva el boton
    }
}
// --- NUEVA FUNCI√ìN: enviarPreguntaUsuario() ---
async function enviarPreguntaUsuario() {
    const preguntaUsuario = document.getElementById('entrada-usuario').value;

    if (!preguntaUsuario || preguntaUsuario.trim() === "") {
        alert("Por favor, escribe tu pregunta o comentario."); // Validaci√≥n
        return;
    }

    // A√±adir la pregunta del usuario al historial de conversaci√≥n (mostrado en la p√°gina)
    document.getElementById('interpretacion').innerHTML += `<p><strong>T√∫:</strong> ${preguntaUsuario}</p>`;

    // A√±adir la pregunta del usuario al historial para la API
    conversacion.push({role: "user", parts: [{text: preguntaUsuario}]});

    // Mostrar el indicador de carga
    document.getElementById('cargando').style.display = 'block';

     // --- HACER LA PETICI√ìN A LA API DE GOOGLE (Generative Language API) ---
    const apiKey = 'TU_CLAVE_DE_API_DE_GOOGLE_AQU√ç'; //  ¬°¬°¬°REEMPLAZA ESTO!!!
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-002:generateContent?key=${apiKey}`;

    try{
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: conversacion, // Usamos el historial
                generationConfig: {
                    "maxOutputTokens": 2048,
                    "temperature": 0.95,
                    "topP": 0.95,
                    "topK": 40
                }
            })
        });
         if (!response.ok) {
            let errorText = await response.text();
            throw new Error(`Error de la API: ${response.status} - ${errorText}`);
        }
         const data = await response.json();
        let interpretacion = "";

                // --- MANEJO DE LA RESPUESTA (Generative Language API) ---
        if (data.candidates && data.candidates.length > 0 && data.candidates[0].content &&
            data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0)
        {
            interpretacion = data.candidates[0].content.parts[0].text;
            //A√±adimos la respuesta al historial para la API
            conversacion.push({ role: "model", parts: [{ text: interpretacion }] });
        }
         else {
            interpretacion = "<p>Error: No se pudo obtener una interpretaci√≥n v√°lida.</p>";
            console.log("Respuesta de la API (fallida):", data); // LOG DE LA RESPUESTA
        }

        // A√±adir la respuesta de la API al historial de conversaci√≥n
        document.getElementById('interpretacion').innerHTML += interpretacion;

        // Limpiar el √°rea de texto
        document.getElementById('entrada-usuario').value = '';

    } catch (error) {
        console.error('Error:', error);
        document.getElementById('interpretacion').innerHTML += `<p>Error al obtener la interpretaci√≥n: ${error.message}</p>`;

    } finally {
        // Ocultar el indicador de carga
        document.getElementById('cargando').style.display = 'none';
    }
} //  <--  FIN de enviarPreguntaUsuario()

    </script>  <!--  <--  CIERRE DE LA ETIQUETA SCRIPT (MUY IMPORTANTE) -->
</body>
</html>
            